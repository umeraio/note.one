<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Security Solution by Umer Malik</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #0f172a;
    color: #e2e8f0;
    margin: 0;
    padding: 0;
}

header {
    background: #111827;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #22d3ee;
}

section {
    padding: 20px;
    margin: 20px;
    background: #1e293b;
    border-radius: 8px;
}

h2 {
    border-bottom: 2px solid #22d3ee;
    padding-bottom: 5px;
}

h3 {
    color: #38bdf8;
    margin-top: 20px;
}

code, pre {
    background: #0f172a;
    padding: 10px;
    display: block;
    overflow-x: auto;
    border-radius: 5px;
    color: #22d3ee;
    border: 1px solid #334155;
}

button {
    background: #22d3ee;
    border: none;
    padding: 8px 14px;
    margin-top: 10px;
    margin-right: 5px;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    transition: background 0.2s;
}

button:hover {
    background: #06b6d4;
}

.download-btn {
    background: #10b981;
    color: white;
}

.download-btn:hover {
    background: #059669;
}

.warning {
    color: #f87171;
    font-weight: bold;
}

.note {
    color: #facc15;
    font-weight: bold;
}

.intro-list {
    line-height: 1.6;
}

footer {
    text-align: center;
    padding: 20px;
    background: #111827;
    color: #94a3b8;
}
</style>

<script>
function copyToClipboard(id) {
    var copyText = document.getElementById(id);
    navigator.clipboard.writeText(copyText.innerText);
    alert("Copied to clipboard");
}

function downloadScript(id, filename) {
    var text = document.getElementById(id).innerText;
    var blob = new Blob([text], { type: 'text/plain' });
    var anchor = document.createElement('a');
    anchor.download = filename;
    anchor.href = window.URL.createObjectURL(blob);
    anchor.target = '_blank';
    anchor.style.display = 'none';
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
}
</script>

</head>
<body>

<header>
Security Solution by Umer Malik
</header>

<section>
    <h2>Getting Started & Instructions</h2>
    <p>This page contains <strong>6 specialized scripts</strong> designed for incident response, forensic collection, and endpoint hardening.</p>
    
    <h3>1. Accessing PowerShell as Administrator</h3>
    <ul class="intro-list">
        <li><strong>Method A:</strong> Press <strong>Windows Key + X</strong> and select <strong>Windows PowerShell (Admin)</strong>.</li>
        <li><strong>Method B:</strong> Press <strong>Windows Key</strong>, type "PowerShell", right-click it, and select <strong>Run as Administrator</strong>.</li>
    </ul>

    <h3>2. Saving the Scripts (Required Folder)</h3>
    <p class="warning">IMPORTANT: All scripts MUST be saved in <code>C:\Scripts</code>. The commands provided rely on this specific folder path.</p>
    
    <h3>3. How to Run Scripts</h3>
    <ul class="intro-list">
        <li><strong>For .ps1 (PowerShell):</strong> Open PowerShell as Admin, copy the "Run Command", paste it, and press Enter.</li>
        <li><strong>For .cmd (Command):</strong> Right-click the file and select "Run as Administrator".</li>
    </ul>
</section>

<section>
    <h2>‚öôÔ∏è Step 0 ‚Äì Automatic Environment Setup</h2>
    <p>Run this script first to automatically create the <code>C:\Scripts</code> folder.</p>
    <h3>Run Command:</h3>
    <pre id="cmd-setup">Set-ExecutionPolicy Bypass -Scope Process; C:\Scripts\Setup_Environment.ps1</pre>
    <button onclick="copyToClipboard('cmd-setup')">Copy Command</button>

    <h3>Save Script As: C:\Scripts\Setup_Environment.ps1</h3>
    <pre id="script-setup">
# Environment Setup Script
# Created by Umer Malik
$Path = "C:\Scripts"
if (!(Test-Path $Path)) {
    New-Item -ItemType Directory -Path $Path | Out-Null
    Write-Host "[+] Folder C:\Scripts created successfully." -ForegroundColor Green
} else {
    Write-Host "[!] Folder C:\Scripts already exists." -ForegroundColor Yellow
}
    </pre>
    <button onclick="copyToClipboard('script-setup')">Copy Script</button>
    <button class="download-btn" onclick="downloadScript('script-setup', 'Setup_Environment.ps1')">Download Script</button>
</section>

<section>
<h2>üî¥ Phase 1 ‚Äì Microsoft 365 Containment</h2>
<p class="warning">Run on CLEAN Admin PC only.</p>

<h3>Step 1: Install Microsoft Graph Module</h3>
<pre id="cmd-install">Install-Module Microsoft.Graph -Scope CurrentUser</pre>
<button onclick="copyToClipboard('cmd-install')">Copy Command</button>

<h3>Step 2: Connect to Microsoft 365</h3>
<pre id="cmd-connect">Connect-MgGraph -Scopes "User.Read.All","Mail.Read","MailboxSettings.Read","AuditLog.Read.All","Directory.Read.All"</pre>
<button onclick="copyToClipboard('cmd-connect')">Copy Command</button>

<h3>Step 3: Run Mailbox Audit Script</h3>
<pre id="cmd1">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\M365_Mailbox_Audit.ps1</pre>
<button onclick="copyToClipboard('cmd1')">Copy Command</button>

<h3>Save Script As: C:\Scripts\M365_Mailbox_Audit.ps1</h3>
<pre id="script1">
# Microsoft 365 Mailbox Security Audit
# Created by Umer Malik

$TimeStamp = Get-Date -Format "yyyy-MM-dd_HH-mm-ss"
$OutputDir = "$env:USERPROFILE\Desktop\M365_Audit_$TimeStamp"
New-Item -ItemType Directory -Path $OutputDir -Force | Out-Null

$Users = Get-MgUser -All

foreach ($User in $Users) {
    $UPN = $User.UserPrincipalName
    try {
        Get-MgUserMailFolderMessageRule -UserId $UPN -MailFolderId Inbox |
        Select DisplayName,Actions,Conditions |
        Out-File "$OutputDir\$($UPN)_InboxRules.txt"
    } catch {}

    try {
        Get-MgUserMailboxSetting -UserId $UPN |
        Select UserPurpose,ForwardingSmtpAddress |
        Out-File "$OutputDir\$($UPN)_Forwarding.txt"
    } catch {}
}
Write-Host "Audit Complete."
</pre>
<button onclick="copyToClipboard('script1')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script1', 'M365_Mailbox_Audit.ps1')">Download Script</button>
</section>

<section>
<h2>üü† Phase 2 ‚Äì Forensic Collection</h2>
<h3>Run Command:</h3>
<pre id="cmd2">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\IR_Deep_Collector.ps1</pre>
<button onclick="copyToClipboard('cmd2')">Copy Command</button>

<h3>Save Script As: C:\Scripts\IR_Deep_Collector.ps1</h3>
<pre id="script2">
# Incident Response Deep Collector
# Created by Umer Malik

$TimeStamp = Get-Date -Format "yyyy-MM-dd_HH-mm-ss"
$OutputDir = "$env:USERPROFILE\Desktop\IR_Collection_$TimeStamp"
New-Item -ItemType Directory -Path $OutputDir -Force | Out-Null

Get-Process | Out-File "$OutputDir\Running_Processes.txt"
netstat -ano | Out-File "$OutputDir\Active_Network_Connections.txt"
schtasks /query /fo LIST /v | Out-File "$OutputDir\Scheduled_Tasks.txt"

reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run |
Out-File "$OutputDir\RunKeys.txt"

reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run |
Out-File "$OutputDir\RunKeys.txt" -Append

Write-Host "Collection Complete."
</pre>
<button onclick="copyToClipboard('script2')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script2', 'IR_Deep_Collector.ps1')">Download Script</button>
</section>

<section>
<h2>üü° Phase 3 ‚Äì Domain-Wide Scan</h2>
<h3>Run Command:</h3>
<pre id="cmd3">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\Domain_Triage.ps1</pre>
<button onclick="copyToClipboard('cmd3')">Copy Command</button>

<h3>Save Script As: C:\Scripts\Domain_Triage.ps1</h3>
<pre id="script3">
# Domain Wide Triage Scanner
# Created by Umer Malik

Import-Module ActiveDirectory
$Computers = Get-ADComputer -Filter * | Select -ExpandProperty Name
$Output = "$env:USERPROFILE\Desktop\Domain_Triage_Report.txt"

foreach ($Computer in $Computers) {
    Invoke-Command -ComputerName $Computer -ScriptBlock {
        Get-Process wscript,cscript,mshta,regsvr32 -ErrorAction SilentlyContinue
    } -ErrorAction SilentlyContinue |
    Out-File $Output -Append
}
Write-Host "Domain Scan Complete."
</pre>
<button onclick="copyToClipboard('script3')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script3', 'Domain_Triage.ps1')">Download Script</button>
</section>

<section>
<h2>üî¥ Phase 4 ‚Äì Malware Cleanup (Infected Machines)</h2>
<h3>Run Command:</h3>
<pre id="cmd6">C:\Scripts\IR_Cleanup_Tool.cmd</pre>
<button onclick="copyToClipboard('cmd6')">Copy Command</button>

<h3>Save Script As: C:\Scripts\IR_Cleanup_Tool.cmd</h3>
<pre id="script5">:: IR_Cleanup_Tool.cmd
:: Created by Umer Malik
@echo off
title IR Cleanup Tool
setlocal

echo Requesting Administrator Authorization...
powershell -NoProfile -ExecutionPolicy Bypass -Command "Start-Process PowerShell -ArgumentList '-NoExit -NoProfile -ExecutionPolicy Bypass -File ""%~f0""' -Verb RunAs" && exit /b

echo --- Stopping malware processes ---
powershell -Command ^
$MaliciousProcs = @("wscript", "cscript", "mshta", "regsvr32"); ^
foreach ($proc in $MaliciousProcs) { ^
    if (Get-Process $proc -ErrorAction SilentlyContinue) { ^
        Write-Host "[!] Stopping active threat engine: $proc" -ForegroundColor Red; ^
        Stop-Process -Name $proc -Force ^
    } ^
}

echo --- Purging temp files and Outlook cache ---
powershell -Command ^
$TempPaths = @("$env:TEMP\*","$env:LOCALAPPDATA\Temp\*","$env:APPDATA\Microsoft\Templates\*.one","$env:USERPROFILE\Downloads\*.one","$env:LOCALAPPDATA\Microsoft\Outlook\RoamCache\*"); ^
foreach ($path in $TempPaths) { ^
    Remove-Item -Path $path -Recurse -Force -ErrorAction SilentlyContinue ^
}
echo [+] Temp folders and Outlook cache cleared.

echo --- Hunting recent OneNote payloads ---
powershell -Command ^
$Drives = Get-PSDrive -PSProvider FileSystem; ^
foreach ($Drive in $Drives) { ^
    Get-ChildItem -Path "$($Drive.Root)*" -Include *.one -Recurse -ErrorAction SilentlyContinue | ^
    Where-Object { $_.CreationTime -gt (Get-Date).AddDays(-14) } | ^
    ForEach-Object { ^
        Write-Host "[!] Found Suspicious OneNote: $($_.FullName)" -ForegroundColor Red; ^
        Rename-Item -Path $_.FullName -NewName "$($_.Name).infected_bak" -ErrorAction SilentlyContinue ^
    } ^
}

echo --- Registry persistence audit ---
powershell -Command ^
$RegPaths = @("HKCU:\Software\Microsoft\Windows\CurrentVersion\Run","HKLM:\Software\Microsoft\Windows\CurrentVersion\Run"); ^
foreach ($path in $RegPaths) { ^
    Get-ItemProperty -Path $path | Select-Object -Property * -Exclude PSPath, PSParentPath, PSChildName, PSDrive, PSProvider | ^
    ForEach-Object { ^
        $props = $_.psobject.properties; ^
        foreach ($prop in $props) { ^
            if ($prop.Value -match "AppData" -or $prop.Value -match "Temp") { ^
                Write-Host "[!] WARNING: Suspicious Registry Key Found in $path" -ForegroundColor Yellow; ^
                Write-Host "    $($prop.Name) -> $($prop.Value)" -ForegroundColor Yellow; ^
            } ^
        } ^
    } ^
}

ipconfig /flushdns
powershell -Command "Start-MpScan -ScanType QuickScan"
echo --- CLEANUP COMPLETE ---
pause</pre>
<button onclick="copyToClipboard('script5')">Copy Full Cleanup Script</button>
<button class="download-btn" onclick="downloadScript('script5', 'IR_Cleanup_Tool.cmd')">Download Script</button>
</section>

<section>
<h2>üîµ Phase 5 ‚Äì Endpoint Hardening</h2>
<h3>Run Command:</h3>
<pre id="cmd7">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\Endpoint_Hardening.ps1</pre>
<button onclick="copyToClipboard('cmd7')">Copy Command</button>

<h3>Save Script As: C:\Scripts\Endpoint_Hardening.ps1</h3>
<pre id="script4">
# Endpoint Hardening Script
# Created by Umer Malik
New-Item -Path "HKLM:\Software\Microsoft\Windows Script Host\Settings" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows Script Host\Settings" -Name "Enabled" -Value 0
New-Item -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name "EnableScriptBlockLogging" -Value 1
Add-MpPreference -AttackSurfaceReductionRules_Ids "D4F940AB-401B-4EFC-AADC-AD5F3C50688A" -AttackSurfaceReductionRules_Actions Enabled
Write-Host "Hardening Applied."
</pre>
<button onclick="copyToClipboard('script4')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script4', 'Endpoint_Hardening.ps1')">Download Script</button>
</section>

<section>
    <h2>‚ö†Ô∏è Troubleshooting & Common Errors</h2>
    <ul class="intro-list">
        <li><strong>Error: "Script.ps1 cannot be loaded because execution of scripts is disabled"</strong>
            <br><em>Fix:</em> Run <code>Set-ExecutionPolicy RemoteSigned -Scope CurrentUser</code> in PowerShell.</li>
        <li><strong>Error: "Access Denied" or "UnauthorizedAccessException"</strong>
            <br><em>Fix:</em> Ensure you are running PowerShell as <strong>Administrator</strong>.</li>
        <li><strong>Error: "The term 'Connect-MgGraph' is not recognized"</strong>
            <br><em>Fix:</em> Run Phase 1, Step 1 (Install Microsoft Graph Module) first.</li>
    </ul>
</section>

<footer>
Crafted through research by Umer Malik
</footer>

</body>
</html>
