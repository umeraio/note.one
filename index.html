<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Security Solution by Umer Malik</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #0f172a;
    color: #e2e8f0;
    margin: 0;
    padding: 0;
}

header {
    background: #111827;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #22d3ee;
}

section {
    padding: 20px;
    margin: 20px;
    background: #1e293b;
    border-radius: 8px;
}

h2 {
    border-bottom: 2px solid #22d3ee;
    padding-bottom: 5px;
}

h3 {
    color: #38bdf8;
    margin-top: 20px;
}

code, pre {
    background: #0f172a;
    padding: 10px;
    display: block;
    overflow-x: auto;
    border-radius: 5px;
    color: #22d3ee;
    border: 1px solid #334155;
}

button {
    background: #22d3ee;
    border: none;
    padding: 8px 14px;
    margin-top: 10px;
    margin-right: 5px;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    transition: background 0.2s;
}

button:hover {
    background: #06b6d4;
}

.download-btn {
    background: #10b981;
    color: white;
}

.download-btn:hover {
    background: #059669;
}

.warning {
    color: #f87171;
    font-weight: bold;
}

.note {
    color: #facc15;
    font-weight: bold;
}

.intro-list {
    line-height: 1.6;
}

.intro-list li {
    margin-bottom: 10px;
}

footer {
    text-align: center;
    padding: 20px;
    background: #111827;
    color: #94a3b8;
}
</style>

<script>
function copyToClipboard(id) {
    var copyText = document.getElementById(id);
    navigator.clipboard.writeText(copyText.innerText);
    alert("Copied to clipboard");
}

function downloadScript(id, filename) {
    var text = document.getElementById(id).innerText;
    var blob = new Blob([text], { type: 'text/plain' });
    var anchor = document.createElement('a');
    anchor.download = filename;
    anchor.href = window.URL.createObjectURL(blob);
    anchor.target = '_blank';
    anchor.style.display = 'none';
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
}
</script>

</head>
<body>

<header>
Security Solution by Umer Malik
</header>

<section>
    <h2>Getting Started & Instructions</h2>
    <p>This page contains <strong>5 specialized security scripts</strong> designed for incident response, forensic collection, and endpoint hardening.</p>
    <p><strong>Purpose:</strong> To provide a centralized toolkit for IT administrators to contain M365 threats, collect forensic data from infected hosts, and sanitize environments after a malware outbreak.</p>
    
    <h3>How to Save These Scripts:</h3>
    <ol class="intro-list">
        <li><strong>Create the Directory:</strong> Open File Explorer, navigate to your <strong>C: Drive</strong>, and create a new folder named <code>Scripts</code> (Path: <code>C:\Scripts</code>).</li>
        <li><strong>Using Notepad:</strong> 
            <ul>
                <li>Click the <strong>"Copy Script"</strong> button on any tool below.</li>
                <li>Open <strong>Notepad</strong> on your computer.</li>
                <li>Paste the code (Ctrl + V).</li>
            </ul>
        </li>
        <li><strong>Saving the File:</strong>
            <ul>
                <li>In Notepad, go to <strong>File > Save As</strong>.</li>
                <li>Navigate to <code>C:\Scripts</code>.</li>
                <li>Change "Save as type" to <strong>All Files (*.*)</strong>.</li>
                <li>Type the filename exactly as specified (e.g., <code>M365_Mailbox_Audit.ps1</code> or <code>IR_Cleanup_Tool.cmd</code>).</li>
            </ul>
        </li>
        <li><strong>Direct Download:</strong> Alternatively, click the <strong>"Download Script"</strong> button to save the file directly with the correct extension.</li>
    </ol>
    <p class="warning">Note: PowerShell scripts (.ps1) may require execution policy changes as shown in the phase instructions.</p>
</section>

<section>
<h2>ðŸ”´ Phase 1 â€“ Microsoft 365 Containment (Run on CLEAN Admin PC)</h2>

<p class="warning">DO NOT run this from an infected machine.</p>

<p class="note">Step 0: Create Folder <code>C:\Scripts</code> and save all scripts there.</p>

<h3>Step 1: Install Microsoft Graph Module</h3>
<pre id="cmd1">Install-Module Microsoft.Graph -Scope CurrentUser</pre>
<button onclick="copyToClipboard('cmd1')">Copy Command</button>

<h3>Step 2: Connect to Microsoft 365</h3>
<pre id="cmd2">Connect-MgGraph -Scopes "User.Read.All","Mail.Read","MailboxSettings.Read","AuditLog.Read.All","Directory.Read.All"</pre>
<button onclick="copyToClipboard('cmd2')">Copy Command</button>

<h3>Step 3: Run Mailbox Audit Script</h3>
<pre id="cmd3">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\M365_Mailbox_Audit.ps1</pre>
<button onclick="copyToClipboard('cmd3')">Copy Command</button>

<h3>Save Script As: C:\Scripts\M365_Mailbox_Audit.ps1</h3>
<pre id="script1">
# Microsoft 365 Mailbox Security Audit
# Created by Umer Malik

$TimeStamp = Get-Date -Format "yyyy-MM-dd_HH-mm-ss"
$OutputDir = "$env:USERPROFILE\Desktop\M365_Audit_$TimeStamp"
New-Item -ItemType Directory -Path $OutputDir -Force | Out-Null

$Users = Get-MgUser -All

foreach ($User in $Users) {
    $UPN = $User.UserPrincipalName

    try {
        Get-MgUserMailFolderMessageRule -UserId $UPN -MailFolderId Inbox |
        Select DisplayName,Actions,Conditions |
        Out-File "$OutputDir\$($UPN)_InboxRules.txt"
    } catch {}

    try {
        Get-MgUserMailboxSetting -UserId $UPN |
        Select UserPurpose,ForwardingSmtpAddress |
        Out-File "$OutputDir\$($UPN)_Forwarding.txt"
    } catch {}
}

Get-MgServicePrincipal |
Select DisplayName,AppId,PublisherName |
Out-File "$OutputDir\OAuth_Applications.txt"

Write-Host "Audit Complete."
</pre>
<button onclick="copyToClipboard('script1')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script1', 'M365_Mailbox_Audit.ps1')">Download Script</button>

</section>

<section>
<h2>ðŸŸ  Phase 2 â€“ Forensic Collection on Infected Machines</h2>

<h3>Step 1: Run Commands</h3>
<pre id="cmd4">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\IR_Deep_Collector.ps1</pre>
<button onclick="copyToClipboard('cmd4')">Copy Command</button>

<h3>Save Script As: C:\Scripts\IR_Deep_Collector.ps1</h3>
<pre id="script2">
# Incident Response Deep Collector
# Created by Umer Malik

$TimeStamp = Get-Date -Format "yyyy-MM-dd_HH-mm-ss"
$OutputDir = "$env:USERPROFILE\Desktop\IR_Collection_$TimeStamp"
New-Item -ItemType Directory -Path $OutputDir -Force | Out-Null

Get-Process | Out-File "$OutputDir\Running_Processes.txt"
netstat -ano | Out-File "$OutputDir\Active_Network_Connections.txt"
schtasks /query /fo LIST /v | Out-File "$OutputDir\Scheduled_Tasks.txt"

reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run |
Out-File "$OutputDir\RunKeys.txt"

reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run |
Out-File "$OutputDir\RunKeys.txt" -Append

Write-Host "Collection Complete."
</pre>
<button onclick="copyToClipboard('script2')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script2', 'IR_Deep_Collector.ps1')">Download Script</button>

</section>

<section>
<h2>ðŸŸ¡ Phase 3 â€“ Domain-Wide Scan (Run on Domain Controller)</h2>

<h3>Step 1: Run Command</h3>
<pre id="cmd5">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\Domain_Triage.ps1</pre>
<button onclick="copyToClipboard('cmd5')">Copy Command</button>

<h3>Save Script As: C:\Scripts\Domain_Triage.ps1</h3>
<pre id="script3">
# Domain Wide Triage Scanner
# Created by Umer Malik

Import-Module ActiveDirectory
$Computers = Get-ADComputer -Filter * | Select -ExpandProperty Name
$Output = "$env:USERPROFILE\Desktop\Domain_Triage_Report.txt"

foreach ($Computer in $Computers) {
    Invoke-Command -ComputerName $Computer -ScriptBlock {
        Get-Process wscript,cscript,mshta,regsvr32 -ErrorAction SilentlyContinue
    } -ErrorAction SilentlyContinue |
    Out-File $Output -Append
}

Write-Host "Domain Scan Complete."
</pre>
<button onclick="copyToClipboard('script3')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script3', 'Domain_Triage.ps1')">Download Script</button>

</section>

<section>
<h2>ðŸ”´ Phase 4 â€“ Malware Cleanup (Run on Infected Machines)</h2>

<h3>Step 1: Run Cleanup Tool</h3>
<pre id="cmd6">C:\Scripts\IR_Cleanup_Tool.cmd</pre>
<button onclick="copyToClipboard('cmd6')">Copy Command</button>

<h3>Step 2: Save Script</h3>
<pre id="script5">
:: IR_Cleanup_Tool.cmd
:: Created by Umer Malik
@echo off
title IR Cleanup Tool
setlocal

echo Requesting Administrator Authorization...
powershell -NoProfile -ExecutionPolicy Bypass -Command "Start-Process PowerShell -ArgumentList '-NoExit -NoProfile -ExecutionPolicy Bypass -File ""%~f0""' -Verb RunAs" && exit /b

echo --- Stopping malware processes ---
powershell -Command ^
$MaliciousProcs = @("wscript", "cscript", "mshta", "regsvr32"); ^
foreach ($proc in $MaliciousProcs) { ^
    if (Get-Process $proc -ErrorAction SilentlyContinue) { ^
        Write-Host "[!] Stopping active threat engine: $proc" -ForegroundColor Red; ^
        Stop-Process -Name $proc -Force ^
    } ^
}

echo --- Purging temp files and Outlook cache ---
powershell -Command ^
$TempPaths = @("$env:TEMP\*","$env:LOCALAPPDATA\Temp\*","$env:APPDATA\Microsoft\Templates\*.one","$env:USERPROFILE\Downloads\*.one","$env:LOCALAPPDATA\Microsoft\Outlook\RoamCache\*"); ^
foreach ($path in $TempPaths) { ^
    Remove-Item -Path $path -Recurse -Force -ErrorAction SilentlyContinue ^
}

echo --- CLEANUP COMPLETE ---
pause
</pre>
<button onclick="copyToClipboard('script5')">Copy Full Cleanup Script</button>
<button class="download-btn" onclick="downloadScript('script5', 'IR_Cleanup_Tool.cmd')">Download Script</button>

</section>

<section>
<h2>ðŸ”µ Phase 5 â€“ Endpoint Hardening (Run AFTER Cleanup)</h2>

<h3>Step 1: Run Hardening Script</h3>
<pre id="cmd7">Set-ExecutionPolicy RemoteSigned -Scope Process
C:\Scripts\Endpoint_Hardening.ps1</pre>
<button onclick="copyToClipboard('cmd7')">Copy Command</button>

<h3>Save Script As: C:\Scripts\Endpoint_Hardening.ps1</h3>
<pre id="script4">
# Endpoint Hardening Script
# Created by Umer Malik

# Disable Windows Script Host
New-Item -Path "HKLM:\Software\Microsoft\Windows Script Host\Settings" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\Software\Microsoft\Windows Script Host\Settings" -Name "Enabled" -Value 0

# Enable PowerShell ScriptBlock Logging
New-Item -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name "EnableScriptBlockLogging" -Value 1

# Enable ASR Rule in Microsoft Defender
Add-MpPreference -AttackSurfaceReductionRules_Ids "D4F940AB-401B-4EFC-AADC-AD5F3C50688A" -AttackSurfaceReductionRules_Actions Enabled

Write-Host "Hardening Applied."
</pre>
<button onclick="copyToClipboard('script4')">Copy Script</button>
<button class="download-btn" onclick="downloadScript('script4', 'Endpoint_Hardening.ps1')">Download Script</button>

</section>

<footer>
Crafted through research by Umer Malik
</footer>

</body>
</html>
